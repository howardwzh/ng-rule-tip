!function(){"use strict";function e(e,l,i){return{restrict:"EA",scope:{ruleTipGlobal:"=ruleTip",ruleTipValue:"=ngModel",ruleTipGroupValue:"=",ruleTipPreset:"=",ruleTipPrivate:"=",ruleTipOnly:"=",ruleTipBlur:"=",ruleTipLimitShow:"=",ruleTipIndex:"@"},controller:r,link:function(r,u,n){function t(){var i=r.ruleTipPreset.tipClass?r.ruleTipPreset.tipClass:"",n=r.ruleTipPreset.tipIcon?r.ruleTipPreset.tipIcon:"",t=u[0].tagName.toLowerCase(),s=o(i,n,r.ruleTipGlobal.isI18n),a=e(angular.element(s))(r);u.after(a),r.addOrRemoveErrorClass=function(){r.ruleTipGlobal.resultObj[r._id]&&r.ruleTipGlobal.tipsObj[r._id]||r.ruleTipOnly&&r.ruleTipOnly.onlyErr[r._onlyIndex]?u.addClass("error-"+t):u.removeClass("error-"+t)},r.ruleTipPreset.postprocess&&u.on("blur",function(){r.$apply(function(){r.postprocess(r.ruleTipPreset.postprocess)})}),!r.ruleTipGlobal.blurShow||"input"!==t&&"textarea"!==t||u.on("blur",function(){l(function(){r.isFocused=!1,null===r.ruleTipGlobal.resultObj[r._id]&&(r.ruleTipGlobal.resultObj[r._id]=!0,r.addOrRemoveErrorClass())},200)}).on("focus",function(){r.$apply(function(){r.isFocused=!0,r.ruleTipGlobal.resultObj[r._id]===!0&&(r.ruleTipGlobal.resultObj[r._id]=null,r.addOrRemoveErrorClass())})})}function o(e,r,l){var i=l?"{{ruleTipGlobal.tipsObj[_id]|translate}}":"{{ruleTipGlobal.tipsObj[_id]}}",u=l?"{{ruleTipOnly.onlyTip|translate}}":"{{ruleTipOnly.onlyTip}}";return'<span class="error-msg '+e+'" ng-show="!ruleTipLimitShow&&(ruleTipGlobal.resultObj[_id]||ruleTipOnly&&ruleTipOnly.onlyErr[_onlyIndex])">'+(r?'<i class="'+r+'"></i>':"")+'<em ng-if="ruleTipGlobal.resultObj[_id]">'+i+'</em><em ng-if="!isFocused&&!ruleTipGlobal.resultObj[_id]">'+u+"</em></span>"}if(r.ruleTipPreset&&r.ruleTipPreset.ruleTip)t();else var s=i(function(){r.ruleTipPreset&&r.ruleTipPreset.ruleTip&&(i.cancel(s),t())},100)}}}function r(e,r,l){function i(){e.$watch("ruleTipPrivate.items."+y,function(e){"undefined"!=typeof e&&(p(),b=c(),b&&o(b))})}function u(){e.$watch("ruleTipPrivate.items."+g,function(e){r.cancel($),$=r(function(){b=c(),e&&b&&o(b)},200)})}function n(){e.$watch("ruleTipOnly.onlyErr["+e._onlyIndex+"]",function(r){e.addOrRemoveErrorClass()})}function t(){d=e.ruleTipPreset,T=e.ruleTipPrivate,f=e.ruleTipGlobal,O=e.ruleTipOnly,O&&(O.onlyArr.push(null),O.onlyErr.push(!1),e._onlyIndex=O.onlyArr.length-1,n()),m=d.diff?d.diff:!1,y=d.items&&d.items.diffKey?d.items.diffKey:!1,g=d.items&&d.items.linkKey?d.items.linkKey:!1,_=m?null:d.ruleTip.tip,j=m?null:d.ruleTip.rule,v=j?j.length:0,h=angular.isDefined(e.ruleTipIndex)?Number(e.ruleTipIndex):"",e._id=d.id+h,e._onlyId=d.id+"Only",f.resultObj||(f.resultObj={},f.tipsObj={}),f.resultObj[e._id]=d.optional?!1:null,!m&&T&&T.params&&(G=T.params,P=G.length),y&&i(),g&&u()}function o(l){r(function(){f.checkNow||(s(l),a(l),e.addOrRemoveErrorClass(),f.isError=/true|null/.test(angular.toJson(f.resultObj)))},50)}function s(r){var l=angular.isDefined(r)&&null!==r?r:"",i=angular.isString(l)&&!d.noTrim?l.replace(/^\s*([^\s]+)\s*$/,"$1"):l,u=0;if(d.optional&&!i)return void(f.resultObj[e._id]=!1);for(var n=0;v>n;n++)if(!angular.isFunction(j[n])&&!j[n].test(i)||angular.isFunction(j[n])&&!j[n](i,G[Math.min(u++,P-1)]))return f.tipsObj[e._id]=_[n],void(f.hideError||e.isFocused?f.resultObj[e._id]=null:f.resultObj[e._id]=!0);f.resultObj[e._id]=!1}function a(r){if(O){var l=angular.isString(r)?r.replace(/^\s*([^\s]+)\s*$/,"$1").toUpperCase():r,i=O.onlyArr,u=y?T.items[y]:null;if(!f.resultObj[e._id]||d.optional)if(d.items&&d.items.group){for(var n=d.items.group.split("+"),t="",o=0,s=n.length;s>o;o++)t+=T.items[n[o]];t=t.toUpperCase(),O.onlyArr[e._onlyIndex]=t?u+"&"+t:null}else O.onlyArr[e._onlyIndex]=l?u+"&"+l:null;else f.resultObj[e._id]&&!d.optional&&(O.onlyArr[e._onlyIndex]=null);f.resultObj[e._onlyId]=!1,E="✡";for(var a=0,p=i.length;p>a;a++){var c=i[a];c&&-1!==E.indexOf("✡"+c+"✡")?(O.onlyErr[a]=!0,f.resultObj[e._onlyId]=!0):(O.onlyErr[a]=!1,E+=c+"✡")}}}function p(){for(var e=0,r=m.length;r>e;e++)if(m[e].test(T.items[y]))return _=d.ruleTip[e].tip,j=d.ruleTip[e].rule,v=j.length,void(T.params&&(G=T.params[e],P=G?G.length:0))}function c(){return angular.isDefined(e.ruleTipValue)?e.ruleTipValue:e.ruleTipGroupValue}var d,T,f,O,b,m,y,g,_,j,v,h,$,E,G=[],P=0;if(e.ruleTipPreset&&e.ruleTipPreset.ruleTip)t();else var w=l(function(){e.ruleTipPreset&&e.ruleTipPreset.ruleTip&&(l.cancel(w),t())},100);e.$watch("ruleTipValue",function(e,r){(e||!e&&r)&&o(e)}),e.$watch("ruleTipGroupValue",function(e,r){(e||!e&&r)&&o(e)}),e.$watch("ruleTipBlur",function(r){r?(e.isFocused=!1,null===f.resultObj[e._id]&&(f.resultObj[e._id]=!0,e.addOrRemoveErrorClass())):r===!1&&(e.isFocused=!0,f.resultObj[e._id]===!0&&(f.resultObj[e._id]=null,e.addOrRemoveErrorClass()))}),e.$watch("ruleTipGlobal.checkNow",function(l){l&&(b=c(),s(b),a(b),e.addOrRemoveErrorClass(),r(function(){f.isError=/true|null/.test(angular.toJson(f.resultObj)),f.checkNow=!1},200))}),e.$watch("ruleTipGlobal.hideError",function(e){e&&r(function(){f.hideError=!1},200)}),e.postprocess=function(r){-1!==r.indexOf("rmSpace")&&(e.ruleTipValue=e.ruleTipValue.replace(/\s+/g,"")),-1!==r.indexOf("rmZero")&&(e.ruleTipValue=e.ruleTipValue.replace(/^0+([1-9]+[0-9]*)/g,"$1")),-1!==r.indexOf("trim")&&(e.ruleTipValue=e.ruleTipValue.replace(/^\s+|\s+$/g,""),e.ruleTipValue=e.ruleTipValue.replace(/\s+/g," "))}}angular.module("ngRuleTip",[]).directive("ruleTip",e),e.$inject=["$compile","$timeout","$interval"],r.$inject=["$scope","$timeout","$interval"]}();